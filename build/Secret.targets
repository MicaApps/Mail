<Project>
  <!-- This target task is designed to replace the application secret file before compilation -->
  <Target Name="ReplaceAppSecret" BeforeTargets="BeforeCompile">
    <PropertyGroup>
      <!-- Define the path of the secret file for Debug configuration -->
      <DebugSecretFile>Secret.cs</DebugSecretFile>

      <!-- Define the path of the secret file for Release configuration. It's expected to be in the 'build' directory -->
      <ReleaseSecretFile>$(MSBuildProjectDirectory)\..\build\Secret.cs</ReleaseSecretFile>
    </PropertyGroup>

    <!-- If the secret file for Release configuration exists, it will replace the one for Debug -->
    <ItemGroup Condition="Exists('$(ReleaseSecretFile)')">
      <Compile Remove="$(DebugSecretFile)" />
      <Compile Include="$(ReleaseSecretFile)" />
    </ItemGroup>

    <Warning Condition="Exists('$(ReleaseSecretFile)')" Text="ReplaceAppSecret: $(CoreCompileDependsOn)" />

    <!-- Raise an error if building in Release configuration but the secret file for Release is not found -->
    <Error Condition="!Exists('$(ReleaseSecretFile)')"
           Text="When compiling in Release, the secret file Secret.cs must exist in the 'build' folder under the solution directory." />
  </Target>
</Project>
