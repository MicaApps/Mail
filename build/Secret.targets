<Project>
  <!-- This target task is designed to replace the application secret file before compilation -->
  <Target Name="ReplaceAppSecret" BeforeTargets="BeforeCompile">
    <PropertyGroup>
      <!-- Define the path of the secret file for Debug configuration -->
      <DebugSecretFile>Secret.cs</DebugSecretFile>

      <!-- Define the path of the secret file for Release configuration. It's expected to be in the 'build' directory -->
      <ReleaseSecretFile>$(MSBuildProjectDirectory)\..\build\Secret.cs</ReleaseSecretFile>
    </PropertyGroup>

    <!-- If the secret file for Release configuration exists, it will replace the one for Debug -->
    <ItemGroup Condition="Exists('$(ReleaseSecretFile)')">
      <Compile Remove="$(DebugSecretFile)" />
      <Compile Include="$(ReleaseSecretFile)" />
    </ItemGroup>

    <Warning Condition="Exists('$(ReleaseSecretFile)')" Text="ReplaceAppSecret: $(CoreCompileDependsOn)" />

    <!-- Raise an error if building in Release configuration but the secret file for Release is not found -->
    <Error Condition="!Exists('$(ReleaseSecretFile)')"
           Text="目前还没有区分调试机密文件和发布机密文件，因此你必须在 build 文件夹中放一个 Secret.cs 文件才能继续编译项目。未来区分调试和发布机密文件后，仅发布设备编译时才需要此文件。" />
  </Target>
</Project>
